---
layout: default
title: Projects
---

<section id="projects">
  <h1>Projects</h1>
  <p>Here are some of my mechanical engineering projects:</p>
  <div id="projects-list"></div>
</section>

<script>
// Base URL for assets (adjusted by Jekyll relative_url filter)
const baseurl = "{{ '/' | relative_url }}";
async function loadProjects() {
    try {
        const res = await fetch('{{ "/assets/data/projects.json" | relative_url }}');
        const projects = await res.json();
        projects.sort((a, b) => new Date(b.date) - new Date(a.date));
        const list = document.getElementById('projects-list');
        for (const item of projects) {
            // Fetch markdown using baseurl prefix
            const mdRes = await fetch(`${baseurl}${item.md}`);
            const mdText = await mdRes.text();
            const parts = mdText.split(/\r?\n\s*\r?\n/);
            const rest = parts.slice(1).join('\n\n');
            // Create project entry
            const entry = document.createElement('article');
            entry.className = 'project-entry';
            entry.innerHTML = `<h2>${item.title}</h2><time datetime="${item.date}">${new Date(item.date).toLocaleDateString()}</time>`;
            // Extract first image from markdown and normalize path
            const imgMatch = mdText.match(/!\[.*?\]\((.*?)\)/);
            if (imgMatch) {
                const rawPath = imgMatch[1];
                // Remove leading '../' segments or leading slashes
                const trimmed = rawPath.replace(/^\/+|^(?:\.\.\/)+/, '');
                // Build full image src with baseurl
                const src = `${baseurl}assets/${trimmed}`;
                const imgEl = document.createElement('img');
                imgEl.src = src;
                entry.appendChild(imgEl);
            }
            // Summary
            const summaryDiv = document.createElement('div');
            summaryDiv.className = 'summary';
            summaryDiv.textContent = item.summary;
            entry.appendChild(summaryDiv);
            // Detailed content
            const moreDiv = document.createElement('div');
            moreDiv.className = 'more';
            moreDiv.innerHTML = marked.parse(rest);
            entry.appendChild(moreDiv);
            // Toggle button
            const toggleBtn = document.createElement('button');
            toggleBtn.className = 'toggle';
            toggleBtn.textContent = 'See more';
            toggleBtn.addEventListener('click', () => {
                const showing = moreDiv.style.display === 'block';
                moreDiv.style.display = showing ? 'none' : 'block';
                toggleBtn.textContent = showing ? 'See more' : 'See less';
            });
            entry.appendChild(toggleBtn);
            list.appendChild(entry);
        }
    } catch (err) {
        console.error('Error loading projects:', err);
    }
}
loadProjects();
</script>